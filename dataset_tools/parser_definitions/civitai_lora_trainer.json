{
  "parser_name": "civitai_lora_trainer",
  "priority": 175,
  "description": "Parses images generated by the Civitai Lora Trainer, which uses A1111-style text metadata but is not from the A1111 WebUI.",
  "version": "1.0",
  "maintainer": "Gemini & Duskfall",
  "target_file_types": ["PNG", "JPEG", "WEBP"],
  "detection_rules": [
    {
      "comment": "Rule 1: Must contain A1111-style key-value pairs.",
      "source_type": "exif_user_comment",
      "operator": "regex_match_any",
      "regex_patterns": ["Steps: ", "Sampler: ", "CFG scale: "]
    },
    {
      "comment": "Rule 2: Must contain a numeric Civitai-style model ID.",
      "source_type": "exif_user_comment",
      "operator": "regex_match",
      "regex_pattern": "Model: [0-9]+\\.safetensors"
    }
  ],
  "parsing_instructions": {
    "input_data": { "source_type": "exif_user_comment" },
    "fields": [
      { "target_key": "prompt", "method": "a1111_extract_prompt_positive" },
      { "target_key": "negative_prompt", "method": "a1111_extract_prompt_negative" },
      { "target_key": "parameters.steps", "method": "key_value_extract_from_a1111_block", "key_name": "Steps", "value_type": "integer" },
      { "target_key": "parameters.sampler_name", "method": "key_value_extract_from_a1111_block", "key_name": "Sampler", "value_type": "string" },
      { "target_key": "parameters.cfg_scale", "method": "key_value_extract_from_a1111_block", "key_name": "CFG scale", "value_type": "float" },
      { "target_key": "parameters.seed", "method": "key_value_extract_from_a1111_block", "key_name": "Seed", "value_type": "integer" },
      { "target_key": "parameters.model_hash", "method": "key_value_extract_from_a1111_block", "key_name": "Model hash", "value_type": "string" },
      { "target_key": "parameters.model", "method": "key_value_extract_from_a1111_block", "key_name": "Model", "value_type": "string" }
    ],
    "output_template": {
      "tool": "Civitai Lora Trainer",
      "prompt": "$prompt",
      "negative_prompt": "$negative_prompt",
      "parameters": {
        "steps": "$parameters.steps",
        "sampler_name": "$parameters.sampler_name",
        "cfg_scale": "$parameters.cfg_scale",
        "seed": "$parameters.seed",
        "model_hash": "$parameters.model_hash",
        "model": "$parameters.model"
      },
      "raw_metadata": "$_input_data_object_for_template"
    }
  }
}